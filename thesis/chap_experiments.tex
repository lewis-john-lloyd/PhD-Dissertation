\chapter{Numerical Results}
\label{chap:results}

There were six test problems developed for this work.
Two of these problems evaluated the implementation and the efficacy of the nonlinear solver.
A third problem with extensive geometric complexity was designed to evaluate the implementation of the domain decomposition algorithm.
The fourth problem demonstrated that selective nonlinear refinement could produce the nonlinear solver's solution with less computational effort.
The fifth problem showed the impact of spatially isolable nonlinearities upon the solution in the remainder of the problem domain.
Finally, the last problem demonstrated the value of using selective nonlinear refinement when simulating a physically relevant situation to reactor safety.
This problem showed that use of the domain decomposition algorithm could obtain results that are more reflective of the nonlinear solver, with less computational time.
The goal of the tests, the methods used, and the models will be discussed in each section.

\section{Single-Phase Flow and Flashing Problems}
\label{sect:single_phase_and_flashing}

The two problems in this section were developed to evaluate the implementation and the efficacy of the nonlinear solver.
The first problem discussed demonstrated that the nonlinear solver reproduces the linear solution in the absence of strong nonlinearities.
The second problem illustrated that the use of the nonlinear solver on a problem with strong nonlinearities produces a solution that is more temporally consistent than that produced with the linear solver.
Additionally, this second problem demonstrated that temporal convergence using the linear solver might be misleading.

\subsection{Model}
\label{subsect:single_model}
The two models developed for these tests were thought problems with generic input conditions.
For both of these problems, the same computational geometry was used;  \fig{fig:exp_geometry} represents the model geometry.
Each block represents a single continuity volume with a fixed \dx{} of 4 [in].
Each continuity cell has a cross-sectional area of 4 [in$^2$].
The solid block at the top of the subchannel represents a boundary cell where the pressure and enthalpy are specified.
It represents an infinite reservoir filled with a fluid at a specified thermodynamic state.
The solid triangle represents a specified flow at the bottom edge of the first continuity volume. 

\begin{figure}[h!tb]
\centering
\input{images/dualModel}
\caption{Geometry for single-phase and flashing problems.}
\label{fig:exp_geometry}
\end{figure}

The two problems, while having the same geometry, are different in their dominant physics.
One problem was designed to simulate single-phase, single-field continuous liquid flow in a subchannel.
This problem will be referred to as the single-phase problem.
The second problem was designed such that high-pressure liquid would flash into steam as it entered a subchannel initially filled with saturated vapor at a much lower pressure, known hereafter as the flashing problem.

\tab{tab:dualInitialConditions} provides the initial conditions for the two problems.
The initial pressure, enthalpy, and volume-fractions for the different fields allowed for a complete description of the problem's thermodynamics state.
The initial velocities for both problems were set to zero.

\begin{table}[h!tb]
\centering
\singlespace
\input{tables/dualInitialConditionsTable}
\caption{Initial conditions for the single-phase and flashing problems.}
\label{tab:dualInitialConditions}
\end{table}

Each of the problems had a specified pressure-enthalpy boundary condition at the outlet and a flow-enthalpy boundary condition at the inlet of the domain.
\tab{tab:dualOutlet} contains the pressure, enthalpy, and composition of the pressure-enthalpy reservoir. 

\begin{table}[h!tb]
\centering
\singlespace
\input{tables/dualOutletTable}
\caption{The outlet boundary conditions for the single-phase and flashing problems.}
\label{tab:dualOutlet}
\end{table}

The flow-enthalpy boundary condition described the thermodynamic state of the in-flowing fluid and its flow rate.
\tab{tab:dualInlet} describes the inlet boundary conditions for the two problems.
The thermodynamic state of the inlet liquid for the flashing problem was unstable.
There was an 87.1 $\displaystyle [\frac{\text{BTU}}{\lbm{}}]$ difference between the inlet enthalpy and the saturation enthalpy at 200 [psia].
This difference drove the liquid's phase change into vapor.

\begin{table}[h!tb]
\centering
\singlespace
\input{tables/dualInletTable}
\caption{The flow-enthalpy boundary conditions for the single-phase and flashing problems.}
\label{tab:dualInlet}
\end{table}

The specified mass flow rates, $\dot{m}(t)$, at the bottom of the subchannels were the same for both problems. 
This time-dependent function is given by \eqref{eqn:bc_time_func_single}.

\begin{equation}
\label{eqn:bc_time_func_single}
\dot{m}(t) = \left\{
\begin{array}{cclrcll}
 0.0           & [\frac{ \lbm{} }{\text{s}}] & , &                & t & \leq 1 & [\text{s}] \\
 0.5 ( t - 1)  & [\frac{ \lbm{} }{\text{s}}] & , & 1\; [\text{s}] < & t & \leq 2 & [\text{s}] \\
 0.5           & [\frac{ \lbm{} }{\text{s}}] & , &                & t & > 2    & [\text{s}]
\end{array}\right.
\end{equation}

Both problems adjusted their initial pressure distribution to account for hydrostatic head.

\subsection{Results}
\label{subsect:single_results}

The two models described above were subjected to timestep-sensitivity studies.
An automated procedure was used to conduct the timestep sensitivity study.
Given an initial \dtmax{}, $\dt{}_{0}$, a refinement factor, $r_{f}$, and the number of timestep size refinements to be taken, $n_{t}$, the simulation was run with both the linear solver and the nonlinear solver for each \dtmax{} in the set, calculated according to \eqref{eqn:timeStepAlgo}.

\begin{equation}
\label{eqn:timeStepAlgo}
\dtmax{} \in \bigcup^{n_{t}-1}_{i\, = 0} \frac{\dt{}_{0}}{r^{i}_{f}}
\end{equation}

For these two problems, the three parameters, $\dt{}_{0}$, $r_{f}$, and $n_{t}$, were 1.0, 10.0, and 6, respectively.
Each of the two problems were run with both the linear and the nonlinear solver at each of the six different \dtmax{}; in total there were 24 simulations run.
The nonlinear convergence criteria used for the nonlinear simulations were $\kmax$ = 35, $F_{\text{tol}}$ = \expneg{1.0}{6}, and $\delta_{\text{tol}}$ = \expneg{1.0}{8}.

The results from the simulations were analyzed to determine the impact of nonlinear convergence upon time-step size sensitivity.
%The solutions produced by both solvers were compared to determine the efficacy of the convergence metric in determining the validity of the nonlinear solution.

\begin{figure}[h!tb]
\centering
\input{plots/single1pt000em0}
\caption{Single-phase solution with $\dtmax{} = \expneg{1.0}{0}$ [s].}
\label{fig:single1pt000em0}
\end{figure}

\begin{figure}[h!tb]
\centering
\input{plots/single1pt000em5}
\caption{Single-phase solution with $\dtmax{} = \expneg{1.0}{5}$ [s].}
\label{fig:single1pt000em5}
\end{figure}

The single-phase case was designed to test if the linear solver produced a result that was equivalent to that produced by the nonlinear solver.
More specifically, it was designed to show that the linear solver provided as accurate a solution, as the nonlinear solver for problems where the physics of interest have relatively low nonlinearities.
\fig{fig:single1pt000em0} and \fig{fig:single1pt000em5} show the solution produced by both the nonlinear and linear solvers of \cobra{}.
The solutions produced by both solvers were qualitatively equivalent at $\dtmax{} = \expneg{1.0}{0}$ [s] and $\dtmax{} = \expneg{1.0}{5}$ [s].
This indicates that the linear solver is adequate in regions where the physics of interest are approximately linear and that the nonlinear solver is capable of reproducing these results.

For the flashing problem, the parameter of interest for temporal convergence testing was $\alpha_g$ at 2 [in] from the inlet of the subchannel.
This parameter was chosen because it represents the region where the nonlinearities should have the largest impact on the solution as this is the location where the flashing occurs.
As such, this location will be sensitive to the rate of vapor formation from the thermodynamically unstable liquid that enters the cell.
\fig{fig:flashing1pt0000em0} shows the gaseous volume fraction 2 [in] from the inlet of the subchannel as a function of time for a \dtmax{} of \expneg{1.0}{1} [s] for both the linear and the nonlinear solvers.

\begin{figure}[h!tb]
\centering
\input{plots/flashing1pt0000em0}
\caption{Flashing solution at \dtmax{} = \expneg{1.0}{1} {[s]}.}
\label{fig:flashing1pt0000em0}
\end{figure}

\begin{figure}[h!tb]
\centering
\input{plots/flashing1pt0000em5}
\caption{Flashing solution at \dtmax{} = \expneg{1.0}{5}{[s]}.}
\label{fig:flashing1pt0000em5}
\end{figure}

\fig{fig:flashing1pt0000em0} shows that the nonlinearly resolved solution is qualitatively different from the linear solution.
Even as the \dtmax{} was reduced, this discrepancy does not disappear, as shown in \fig{fig:flashing1pt0000em5}.
The two solutions did converge to the same solution as the timestep size was reduced.
Both \fig{fig:flashingAlphaLin} and \fig{fig:flashingAlphaNln} show that as the timestep size was reduced the two different solutions became more timestep-size insensitive.
However, the solution produced by the nonlinear solver, \fig{fig:flashingAlphaNln}, qualitatively varied less as the $\dtmax{}$ was reduced than that produced by the linear solver, \fig{fig:flashingAlphaLin}.

\begin{figure}[h!tb]
\centering
\input{plots/flashingAlphaLin}
\caption{Linear solver flashing solutions.}
\label{fig:flashingAlphaLin}
\end{figure}

\begin{figure}[h!tb]
\centering
\input{plots/flashingAlphaNln}
\caption{Nonlinear solver flashing solutions.}
\label{fig:flashingAlphaNln}
\end{figure}

The two solvers, when applied to the same problem that contains highly nonlinear physics, produced two different timestep-size invariant solutions.
These two solutions achieved qualitative timestep-size invariance at different timestep sizes.
The parameter of interest in the solution produced by the nonlinear solver with $\dtmax{} = \expneg{1.0}{0}$ [s] was qualitatively close to that produced with $\dtmax{} = \expneg{1.0}{1}$ [s], \fig{fig:flashingDtInsensitiveNln}.
The same level of qualitative timestep-size invariance was not evident in the linear solver's solutions until the solutions with a $\dtmax{}$ of \expneg{1.0}{3} [s] and \expneg{1.0}{4} [s] were compared, as shown in \fig{fig:flashingDtInsensitiveLin}.

\begin{figure}[h!tb]
\centering
\input{plots/flashingDtInsensitiveNln}
\caption{Nonlinear solver timestep-size insensitive flashing solution.}
\label{fig:flashingDtInsensitiveNln}
\end{figure}

\begin{figure}[h!tb]
\centering
\input{plots/flashingDtInsensitiveLin}
\caption{Linear solver timestep-size insensitive flashing solution.}
\label{fig:flashingDtInsensitiveLin}
\end{figure}

The timestep-size insensitive solution produced by the nonlinear solver occurred at a maximum timestep size three orders of magnitude greater than that achieved by the linear solver.
An examination of the nonlinear residual over the course of the transient provided insight into why this behavior was observed.
For the linear runs, the scaled residuals were evaluated after a single Newton step, $\tilde{\vec{F}}^{1}$.
For the nonlinear runs, the scaled residuals were evaluated at the end of the Newton-loop, $\tilde{\vec{F}}^{k}$.
The linear solver's solution's scaled residual indicated that, even for small timestep sizes, the solution obtained did not satisfy the discrete nonlinear equations, \fig{fig:flashingResidualLin}.
This was in contrast to the nonlinear solver's solution, which showed a lower residual over the course of the simulation, \fig{fig:flashingResidualNln}.

\begin{figure}[h!tb]
\centering
\input{plots/flashingResidualLin}
\caption{Residual of the flashing solution for the linear solver.}
\label{fig:flashingResidualLin}
\end{figure}

\begin{figure}[h!tb]
\centering
\input{plots/flashingResidualNln}
\caption{Residual of the flashing solution for the nonlinear solver.}
\label{fig:flashingResidualNln}
\end{figure}

The reduction in the residual produced by the linear solver, \fig{fig:flashingResidualLin}, shows that the reduction of the maximum allowable timestep size serves two purposes.
The first is that as \dtmax{} is reduced the nonlinear physics are being better resolved; however, even for small \dtmax{}, the residuals are still large compared to those of the nonlinear solution, \fig{fig:flashingResidualNln}.
The second purpose in reducing \dtmax{} is to decrease the error due to the discrete approximation of the temporal integral of the governing equations.
While the reduction of the maximum timestep size in the linear solver serves the purpose of reducing the residual, the nonlinear solver performs this task naturally.
Therefore, in the nonlinear solver the reduction of the maximum timestep size primarily serves to reduce the error from the approximate discrete temporal integral.

Taken together, the above results indicate that the nonlinear solver was implemented correctly and performed as intended.

%One way to quantify the difference between the solutions is by measuring the residual convergence metrics outlined in \sect{sect:temporal_convergence}.
%These metrics provide a measure of how poorly the discrete nonlinear equations are being solved at every timestep in the transient.
%The resolution of the residual allows for a solution that is less sensitive to timestep size selection than for a solution that does not resolve the residual.
%The convergence metrics will be used to determine if a qualitative temporal-convergence determination can lead to the acceptance of a solution that is not nonlinearly converged.
%
%For each of the test cases, the two different metrics were compared at the different \dtmax{}.
%These convergence metrics were evaluated during post-processing.
%To examine efficacy of the temporal convergence criteria, both the average and moment-based temporal convergence criteria were evaluated for each of the 24 simulations.
%The values of these metrics will be compared between different solvers for the same test problem. 
%The two different nonlinear convergence metrics will now be examined for the flashing problem.
%\tab{tab:flashingMetric} shows both the average metric, $\tilde{R}$, and the moment-based metric, $\tilde{R}_{\text{M}}$.
%\tab{tab:singleMetric} shows the two metrics for the single-phase problem.
%
%\begin{table}[h!tb]
%\centering
%\singlespace
%\input{tables/flashingMetricTable}
%\caption{Nonlinear convergence metrics for flashing problem.}
%\label{tab:flashingMetric}
%\end{table}
%
%\begin{table}[h!tb]
%\centering
%\singlespace
%\input{tables/singleMetricTable}
%\caption{Nonlinear convergence metrics for the single-phase problem.}
%\label{tab:singleMetric}
%\end{table}

%============================================================================
% Problem that shows that the domain decomposition algorithm is implemented correctly.
%============================================================================
\FloatBarrier
\section{Complex Geometry Problem}
\label{sect:complexProblem}
The complex geometry problem tested whether the domain decomposition algorithm was implemented properly.
To properly test the domain decomposition algorithm many different permutations of the composition of the nonlinear domain were required.
The presence of both axial momentum flow paths and transverse momentum flow paths were also necessary.
If the nonlinear domain of the decomposed problem were subjected to a single Newton step, then the resulting dual domain solution should match within numerical round off that of a single domain with a single Newton step regardless of the composition of the nonlinear domain.
A model of the General Electric (GE) nine-rod subchannel experimental facility \cite{Lahey1970} suited the requirements of this test.

\subsection{Model}
\label{sect:complexModel}

The GE experiments were conducted in an experimental facility with a nine-rod bundle representative of a boiling water reactor subchannel.
The exact geometry of the experimental facilities can be found in the GE technical report \cite{Lahey1970}.
The basic layout of the portion of the facility that was of interest to this work was as follows: there was an inlet plenum that opened up into a nine-rod bundle whose cross-section is depicted in \fig{fig:channel_layout}; above the rod-bundle there was an outlet plenum.

\begin{figure}[h!tb]
\centering
\input{images/position_of_pressure_taps}
\caption{Cross-section of rod bundle geometry adapted from GE experiment \cite{Lahey1970}.}
\label{fig:channel_layout}
\end{figure}

The computational model was broken into three sections.
The first section was the inlet plenum, while the third section was the outlet plenum.
The inlet plenum was 12 [in] tall with a cross-sectional area of 2.93 $[ \text{in}^2]$.
The outlet plenum was identically dimensioned.
The second section represented the rod-bundle.
This section was 121.5 [in] tall.
The rod-bundle was approximated by a four-by-four grid of sixteen subchannels.
There were the four corner subchannels, the eight side subchannels, and the four center subchannels in the model.
The dimensions for the various subchannels are shown in \fig{fig:channel_layout}.

The primary purpose of this problem was to test the ability of the domain decomposition algorithm to accurately recover the linear solution when the nonlinear domain was restricted to a single Newton step.
For that reason the details of the boundary and initial conditions are omitted here.

There were eighteen subchannels in this model: the 16 subchannels in the rod bundle, the inlet plenum, and the outlet plenum.
This meant that there were $2^{18}$ possible ways to decompose this problem with the domain decomposition algorithm.
The time required to run all possible permutations was prohibitive, so only a subset were simulated here.
To test if the domain decomposition algorithm was implemented correctly, 256 different permutations were selected at random and run.

\subsection{Results}
\label{sect:complexResults}

The intent of this problem was to determine if the domain decomposition algorithm was properly implemented.
When using the domain decomposition algorithm, if only a single Newton step is permitted in the nonlinear domain, then solution obtained should be equivalent to taking only a single Newton step over the entire domain.
This provided the basis for the following comparison.
Regardless of how the $2^{18}$ subchannels of the problem were allocated between the linear and the nonlinear domains, the solutions produced by the domain decomposition algorithm should have been within round-off error to that produced by the single domain linear solver.
However, the different linear algebra involved with the domain decomposition should not produce the same floating-point solution as that produced by the linear solver.
This floating-point variance should not influence the solution above the level of numerical round-off error.
However, the traditional \cobra{} graphics file was created with single precision variables.
These single precision variables were incapable of capturing the error present in the simulation since, to single precision, the results were always the same between the domain decomposed and the non-decomposed solutions.
A special version of \cobra{} was compiled that produced the variables of interest in double precision.

There were 256 different simulations run: one where the entire domain was linear, one where the entire domain was nonlinear and 254 where a random number of random subchannels were nonlinear.
This collection was a representative subset of the $2^{18}$ possible decompositions.
For each of these simulations, the pressures at two locations were recorded: the pressures near the top and near the bottom of the upper left corner subchannel of \fig{fig:channel_layout} were chosen.
The differences between the pressures at each of these two points and the pressures produced by the linear solver were summed over the course of the transient.
\eqref{eqn:complexError} shows this value for a given transient simulation, $k$, at a given location in the simulation, $j$, over the course of a transient with $N_{t}$ timesteps.

\begin{equation}
\label{eqn:complexError}
\text{Error}_{j, k} = \sum_{i\,=\,1}^{N_{t}} \abs{P_{j,1} -P_{j, k}}
\end{equation}

The bar graph in \fig{fig:complexBar} shows the distribution of these errors at both the top and bottom of the subchannel.

\begin{figure}[h!tb]
\centering
\input{plots/complexBar}
\caption{Histogram of pressure error at two locations.}
\label{fig:complexBar}
\end{figure}

These results indicate that the domain decomposition algorithm was implemented correctly.

%============================================================================
% Problem that shows that when it is possible to isolate the nonlinearities, the computational cost can be lower.
%============================================================================
\FloatBarrier
\section{Valve-Type Problem}
\label{sect:valveProblem}

This problem was designed to demonstrate the ability of the domain decomposition algorithm to resolve isolated nonlinearities at a lower computational cost than the fully nonlinear solver. 
First, the model will be discussed and initial and boundary conditions provided.
Second, the timestep sensitivity study of the solution for both the linear and the nonlinear solver will be detailed.
Next, the portion of the domain with the nonlinearities will be isolated via the domain decomposition algorithm and another timestep sensitivity study will be conducted.
Finally, the solution and run time data from the three methods will be compared.

\subsection{Model}
\label{subsect:valveModel}

The system being modeled was that of four vertical subchannels, \fig{fig:valveModel}.

\begin{figure}[h!tb]
\centering
\input{images/valveModel}
\caption{Model of valve problem.}
\label{fig:valveModel}
\end{figure}

Each subchannel was modeled as having eight continuity volumes, each with a height, $\dx{}$, of 5 [in] and a cross-sectional area, $ A_{c} $, of 16 $[\text{in}^{2}]$.
Subchannel 1 had a complete obstruction that prevented flow.
Subchannels 2 and 3 each had a fixed obstruction, manifested as loss coefficients, along their lengths.
Subchannel 4 had a boundary condition that imitated the behavior of a valve by using a time dependent loss coefficient.
Initially fully open, the valve slowly closed.
While closing, the valve stopped twice at cross-sectional areas that were equivalent to the two loss coefficients of the two partially obstructed subchannels.
After fully closing, the valve returned to its first stopping point.

The subchannels were initially full of subcooled liquid at 800 $[ \text{psia}] $.
The bottoms and the tops of the subchannels were open to reservoirs.
The bottom reservoir, denoted by the grey squares marked with the letter A, was full of subcooled liquid with a time variant pressure.
The pressure in the bottom reservoir started at 802 $[ \text{psia}]$ and increased to 818 $[ \text{psia}]$ over the first second, staying there for the duration of the problem.
The top reservoir, denoted by the black squares marked with the letter B, was full of subcooled liquid at 800 $[\text{psia} ] $.
This pressure did not change over the course of the transient.
The pressure difference that existed between these two reservoirs was what drove the flow in this problem.

The model used was a single section.
Within that section there were four subchannels.
These subchannels were hydrodynamically isolated from each other.
The two partially obstructed subchannels had user-defined loss coefficients placed at an elevation of 15 [in].
The two coefficients were 40 $[-]$ and 160 $[-]$.
The fully obstructed subchannel had a no-flow boundary condition at 15 [in].
The fourth subchannel had a time dependent area ratio multiplier, $A(t)_r$, at 15 [in].
This multiplier acted to reduce the area of the momentum flow path, $A_m$, used in the determination of form losses and wall drag.
However, these four subchannels had their wall drag terms artificially reduced.
Reducing the wall drag allowed the impact of the loss coefficients upon the solution to be isolated.
Since there was no wall drag in this problem, the area ratio could be related to the effective loss coefficient, $K(t)$, by \eqref{eqn:valveLossCoefficient}.

\begin{equation}
\label{eqn:valveLossCoefficient}
K(t) = \frac{K_{o}}{{A(t)_r}^2}
\end{equation}

The base loss coefficient, $K_o$, for subchannel four was 10 [-].
Using \eqref{eqn:valveLossCoefficient}, the equivalent area ratios for the loss coefficients of the two partially obstructed subchannels, 40 [-] and 160 [-], were 0.5 and 0.25 respectively.
The time dependent area ratio multiplier for subchannel four is shown in \fig{fig:valveTransientArea}.

\begin{figure}[h!tb]
\centering
\input{plots/valveTransientArea}
\caption{Transient area ratio for vale-type problem.}
\label{fig:valveTransientArea}
\end{figure}

The simulation was run to an end time of 19 seconds.
The functional form of the transient area boundary condition was chosen so that the solution of the transient area subchannel would mimic each of the three other subchannels for portions of the transient.

\subsection{Results}
\label{subsect:valveResults}

The parameter of interest was the flow  rate of liquid at 15 [in] above the inlet.
This location corresponded to the location of the loss coefficients, the no-flow boundary condition, or the variable momentum-area boundary condition in each of the respective subchannels.
For this study, $\dt{}_{0}$, $r_{f}$, and $n_{t}$ used in \eqref{eqn:timeStepAlgo} were 1.0, 2.0, and 10, respectively.
Upon examining the solution, it was determined that timestep size was $\dtcrnt{}$ limited for a portion of the transient until \dtmax{} = \expneg{1.56}{2}{[s]} was reached.
The timestep histories of the simulations from $\dtmax{} = \expneg{1.0}{0}$ [s] through $\dtmax{} = \expneg{6.25}{2}$ [s] were identical for both the linear and the nonlinear solution.
As such, the first four simulation results for each solver were dropped from the data sets since they represented duplicate results.
The solution obtained with \dtmax{} = \expneg{6.25}{2}{[s]} with the linear solver is shown in \fig{fig:valveLin6pt25em02}.

\begin{figure}[h!tb]
\centering
\input{plots/valveLin6pt2500em02}
\caption{Valve problem with \dtmax{} = \expneg{6.25}{2}{[s]} with the linear solver.}
\label{fig:valveLin6pt25em02}
\end{figure}

This solution shows that the there is a non-physical spike in the mass flow rate when the closed valve starts to open at 15 [s].
This behavior was observed for the linear solver's solutions at successively smaller max timesteps through the smallest \dtmax{}, \expneg{1.95}{3}{[s]}.

\begin{figure}[h!tb]
\centering
\input{plots/valveLinSols}
\caption{Zoom of non-physical behavior at 15 [s] in linear solutions.}
\label{fig:valveLinSols}
\end{figure}

The presence of the non-physical behavior in the flow rate in the simulation with \dtmax{} = \expneg{1.56}{2}{[s]}, a \dtmax{} that produced a \dt{} history that was never \dtcrnt{} limited, necessitated that additional timestep refinements be examined for a smooth solution.
Subsequent timestep refinements produced results where the flow-rate spikes became progressively smaller; however, the time-step refinement study did not yield a solution that was free of this perturbation, as shown in \fig{fig:valveLinSols}.
The lack of a linear solution that was free from this perturbation was not an impediment to this study since the purpose was not to find a \dtmax{} that produces such a solution.
Instead, \tab{tab:valveLinTable} shows the run time statistics for the linear solver's solutions.

\begin{table}[h!tb]
\centering
\singlespace
\input{tables/valveLinTable}
\caption{Run time data for the valve problem using the linear solver.}
\label{tab:valveLinTable}
\end{table}

In \tab{tab:valveLinTable} the first column shows the maximum timestep size for the simulation.
The second column shows the number of successful timesteps taken, $N_{t}$.
The third column is the CPU time required to complete simulation, $T_{\text{CPU}}$.
The final column is the CPU time per timestep for a given simulation.
On average, the CPU time per timestep was \expneg{2.8}{3}{[s]} for the linear solution.

Next, the nonlinear solver was used to perform the same timestep sensitivity study.
The same set of \dtmax{} was run.
The solution at \dtmax{} = \expneg{6.25}{2}{[s]} is shown in \fig{fig:valveNln6pt25em02}

\begin{figure}[h!tb]
\centering
\input{plots/valveNln6pt2500em02}
\caption{Valve problem with \dtmax{} = \expneg{6.25}{2}{[s]} with the nonlinear solver.}
\label{fig:valveNln6pt25em02}
\end{figure}

The solution obtained with a \dtmax{} = \expneg{6.25}{2}{[s]} did not exhibit the nonphysical spike in the flow rate that the linear solution displayed.
This solution was also obtained at the largest \dt{} run in the study, \expneg{1.0}{0}{[s]}.
Reducing the \dtmax{} produced solutions that were qualitatively identical to that shown above.
\fig{fig:valveNlnSols} shows the same zoomed view of at 15 [s], when the valve opens.

\begin{figure}[h!tb]
\centering
\input{plots/valveNlnSols}
\caption{Zoom of nonlinear solutions at 15 [s].}
\label{fig:valveNlnSols}
\end{figure}

These results indicate that the linear solver's timestep refinement serves the purpose of trying to resolve an isolated linearization error in a single subchannel of the problem.
By using the nonlinear solver, that error was removed and subsequent timestep reductions were not necessary to obtain the physical solution.
However, \tab{tab:valveNlnTable} shows that the nonlinear solver takes more CPU time per timestep than the linear solver.

\begin{table}[h!tb]
\centering
\singlespace
\input{tables/valveNlnTable}
\caption{Run time data for the valve problem using the nonlinear solver.}
\label{tab:valveNlnTable}
\end{table}

Given that the nonlinearities in this problem were clearly isolated in a single subchannel, using the domain decomposition algorithm provided an ideal test to determine if a nonlinearly converged solution could be obtained at a lower computational cost than the full nonlinear solver.
The use of the domain decomposition algorithm in this problem was restricted to the subchannel with the valve.
The other three subchannels were not included in the nonlinear domain.
The same set of timesteps was run to collect data.
\fig{fig:valveDom6pt25em02} shows the solution as obtained with \dtmax{} = \expneg{6.25}{2}{[s]}; the results in this figure are qualitatively indistinguishable from the results of the nonlinear solver.

\begin{figure}[h!tb]
\centering
\input{plots/valveDom6pt2500em02}
\caption{Valve problem with \dtmax{} = \expneg{6.25}{2}{[s]} and domain decomposition active.}
\label{fig:valveDom6pt25em02}
\end{figure}

The results for subsequently smaller timesteps were indistinguishable from those presented in \fig{fig:valveNlnSols}.
This result indicates that the nonlinear solution can be obtained with the domain decomposition algorithm.
Since the nonlinearities were designed to be isolated, this result was expected.
However, the run time statistics, \tab{tab:valveDomTable}, provided additional information about the domain decomposition algorithm's performance.

\begin{table}[h!tb]
\centering
\singlespace
\input{tables/valveDomTable}
\caption{Run time data for the valve problem using domain decomposition.}
\label{tab:valveDomTable}
\end{table}

\begin{figure}[h!tb]
\centering
\input{plots/valveRunTime}
\caption{CPU time per timestep for the nonlinear and the domain decomposition runs.}
\label{fig:valveRunTime}
\end{figure}

The CPU time per time step of the domain decomposition was lower than that obtained by the nonlinear solver.
\fig{fig:valveRunTime} shows that the domain decomposition algorithm is capable of producing the same solution as the nonlinear solver at less than half the cost per timestep than the nonlinear solver.

As the \dtmax{} was reduced, the cost of the nonlinear solver decreased because there were fewer nonlinear iterates required per timestep.
This reduction in the number of Newton iterates per timestep was also evident in the domain decomposition run-time plot.
This problem was developed to show that for a problem with isolable nonlinearities, the application of the domain decomposition algorithm to resolve those nonlinearities would result in a smaller computational cost than the global nonlinear solver while producing results that were qualitatively as accurate.

%============================================================================
% Problem that shows that local nonlinearities can impact the global solution adversely.
%============================================================================
\FloatBarrier
\section{Filling Pipe Problem}
\label{sect:vmp}
This problem was developed to illustrate that using the domain decomposition algorithm to resolve localized nonlinearities produced a global solution that was in-line with the nonlinear solution.
First, the differences in the solutions obtained by the linear and the nonlinear solvers at large $\dtmax{}$ will be shown.
Second, the solution at smaller $\dtmax{}$ will be shown to be in agreement with the analytic solution for both the linear and the nonlinear solver.
Third, the solution produced by the domain decomposition algorithm will be shown as a function of timestep size.
Finally, the impact of resolving or not resolving local nonlinearities on the global solution will be discussed.

\subsection{Model}
\label{subsect:vmpModel}

A vertical pipe slowly filling with saturated water at atmospheric pressure was the basis for this simulation.
The pipe was 3 [ft] tall, having a 36 [in$^{2}$] cross-sectional area and a wetted perimeter of 24 [in].
The pipe was initially full of saturated steam at 14.7 [psia].
The top of the pipe was open to an infinite reservoir of saturated steam at 14.7 [psia].
Saturated water flowed into the bottom of the pipe, displacing the steam.
The boundary and initial conditions are contained in \tab{tab:vmpBCIC}.

\begin{table}[h!tb]
\centering
\singlespace
\input{tables/vmpBCICTable}
\caption{Initial and boundary conditions for the fill problem.}
\label{tab:vmpBCIC}
\end{table}

The pressure at a given point in the pipe had a simple, closed-form, analytic solution under the assumptions listed below.
The first assumption was that the variations in the liquid's specific volume, $v_{l}$, within the range of pressures experienced during the course of the simulation could be neglected.
The liquid flow rate into the problem is given by \eqref{eqn:vmpMassFlowRate}.

\begin{equation}
\label{eqn:vmpMassFlowRate}
\dot{m}_{l}(t) = \left\{
\begin{array}{cclrcll}
 \dot{m}_{l,\text{max}}\cdot t & [\frac{ \lbm{} }{\text{s}}] & , & 0\; [\text{s}] < & t & \leq 1 & [\text{s}] \\
 \dot{m}_{l,\text{max}}        & [\frac{ \lbm{} }{\text{s}}] & , &                  & t & > 1    & [\text{s}]
\end{array}\right.
\end{equation}

The maximum flow rate, $\dot{m}_{l,\text{max}}$, was 0.406503 $ [ \frac{\lbm{}}{s} ]$.
The volumetric flow rate is given by \eqref{eqn:vmpVolumetricFlowRate}.

\begin{equation}
\label{eqn:vmpVolumetricFlowRate}
\dot{V}(t) = v_{l} \dot{m}_{l}(t)
\end{equation}

The volumetric flow rate could be expressed as $\dot{V}(t) = A_{c} \dot{h}(t)$, where $\dot{h}(t)$ and $A_{c}$ were the rate of change in height as a function of time and the cross-sectional area of the pipe, respectively.
Integrating \eqref{eqn:vmpVolumetricFlowRate} produced the total volume of liquid in the pipe, $V(t)$, as a function of time, \eqref{eqn:vmpTotalLiquid}, which could represented as a function of height, $h(t)$.

\begin{equation}
\label{eqn:vmpTotalLiquid}
V(t) = A_{c} h(t) = 
 \left\{
\begin{array}{cclrcll}
v_{l} \dot{m}_{l,\text{max}}\frac{t^{2}}{2} & [ \text{ft}^{3} ] & , & 0\; [\text{s}] < & t & \leq 1 & [\text{s}] \\
v_{l} \dot{m}_{l,\text{max}} \left( t - \onehalf  \right) & [ \text{ft}^{3} ] & , &                  & t & > 1    & [\text{s}]
\end{array}\right.
\end{equation}

Neglecting the hydrostatic head contribution from the vapor column, the pressure at any height and point in time in the problem, $P(t, h(t))$, is given by \eqref{eqn:vmpHydroStaticHead}.
If the water level had yet to reach a given point, the pressure was  14.7 [psia], $P_o$.
If the water level had reached a given point, then the pressure at that point was given by the hydrostatic pressure dictated by the height of the liquid column above that point, \eqref{eqn:vmpHydroStaticHead}.

\begin{equation}
\label{eqn:vmpHydroStaticHead}
P(t, h(t))= 
 \left\{
\begin{array}{cclrcll}
P_o & [ \text{psia} ] & , & 0\; [\text{s}] < & t & \leq t^{*}(h) & [\text{s}] \\
P_o + g \frac{ h(t) - h }{ v_{l} } & [ \text{psia} ] & , &  & t & > t^{*}(h) & [\text{s}]
\end{array}\right.
\end{equation}

The function $t^{*}(h)$ in \eqref{eqn:vmpHydroStaticHead} is given by \eqref{eqn:vmpTimeStar} and represents the time it takes the water level to reach a given height.

\begin{equation}
\label{eqn:vmpTimeStar}
t^{*}(h)= 
 \left\{
\begin{array}{cclrcll}
\sqrt{\frac{2 A_c h}{v_{l} \dot{m}_{l,\text{max}}}} & [ \text{s} ] & , & 0\; [ \text{ft}] < & h & \leq \frac{v_l \dot{m}_{l,\text{max}}}{2 A_c} & [\text{ft}] \\
\frac{ A_c h }{v_{l} \dot{m}_{l,\text{max}}} + \onehalf & [ \text{s} ] & , &                & h & > \frac{v_l \dot{m}_{l,\text{max}}}{2 A_c} & [\text{ft}]
\end{array}\right.
\end{equation}

This analytic function for pressure, evaluated at six different axial heights from 0.0 [s] to 75.0 [s], is shown in \fig{fig:vmpAnalyticSol}.

\begin{figure}[h!tb]
\centering
\input{plots/vmpAnalytic}
\caption{Analytic solution to the filling problem.}
\label{fig:vmpAnalyticSol}
\end{figure}

The model of this pipe was composed of two sections, each with a single subchannel.
While it was not necessary for so simple a problem to have multiple sections, it was done to allow the domain decomposition algorithm to run, since the algorithm uses subchannels to decompose the domain.
The subchannel in the bottom section was 1 [ft] tall and was broken into three continuity volumes, each 4 [in] high.
The top section's subchannel was 2 [ft] tall and was broken into six continuity volumes, each 4 [in] high.
\fig{fig:fillModel} shows the \cobra{} model for this problem.

\begin{figure}[h!tb]
\centering
\input{images/fillModel}
\caption{\cobra{} model for the filling problem.}
\label{fig:fillModel}
\end{figure}


First, the simulation was run once with each of the linear and the nonlinear solvers.
The nonlinear convergence parameters were \kmax{} = 35, $F_{tol} = \expneg{1.0}{6}$, and $\delta_{tol} = \expneg{1.0}{8}$. 
Each simulation was run for 75 $[ \text{s} ]$.
The \dtmax{} was reduced several times over two orders of magnitude to determine timestep sensitivity.

For each simulation, a time-averaged error measure was calculated.
The error at a given point was determined by taking the square root of the integral of the squared difference between the analytic pressure, $P_{\text{ana}}$, and the calculated pressure divided by the total simulation run time, $T$.
This error at the center of the lower six continuity volumes was summed to produce a measure of the error in the calculated result, \eqref{eqn:vpmPressureError}.
The bottom six continuity volumes were selected since the simulation was run only until they were filled.

\begin{equation}
\label{eqn:vpmPressureError}
e_{p} =  \frac{1}{\sqrt{T}} \sum_{i\,=\,1}^{6}\sqrt{\int_{0}^{T} \left(P_{i,\text{ana}}(t) - P_{i}(t)\right)^{2} \mathrm{d} t}
\end{equation}

Next, the domain decomposition algorithm was activated.
There were two simulations in this run: one was with the bottom subchannel in the nonlinear domain and the other with the top subchannel in the nonlinear domain.
The \dtmax{} for these runs was chosen to be \expneg{1.0}{1}{[s]}.
The solutions of these runs are compared to the solutions produced by the single domain solvers in the following section.

\subsection{Results}
\label{subsect:vmpResults}

The simulation was first run with the linear solver.
The \dtmax{} was chosen to be \expneg{1.0}{1}{[s]}.
The pressure at the center of the bottom six continuity volumes in the problem are shown in \fig{fig:linFill1em1}.

\begin{figure}[h!tb]
\centering
\input{plots/vmpLinear1em1}
\caption{Filling problem with \dtmax{} = \expneg{1.0}{1}{[s]} with the linear solver.}
\label{fig:linFill1em1}
\end{figure}

The solution at this \dtmax{} was noisy and when the actual timestep sizes were examined, \dtmax{} was infrequently reached due to restrictive \dtcrnt{} limits.
The measure of error, $e_{p}$, for this simulation was \expneg{7.5}{2}{[psia]}.

\begin{figure}[h!tb]
\centering
\input{plots/vmpLinear5em2}
\caption{Filling problem with \dtmax{} = \expneg{5.0}{2}{[s]} using the linear solver.}
\label{fig:vmpLinFill5em2}
\end{figure}

The solution from the simulation with \dtmax{} = \expneg{5.0}{2}{[s]}, \fig{fig:vmpLinFill5em2}, was more in line with the analytic solution, \fig{fig:vmpAnalyticSol}.
The slight spikes visible in \fig{fig:vmpLinFill5em2} are characteristic of the \cobra{} software.
They cannot be removed by either resolution of nonlinearities or reduction in timestep size.
\tab{tab:vmpLinRunTime} shows the run time data for the linear cases that were run.

\begin{table}[h!tb]
\centering
\singlespace
\input{tables/vmpLinRunTimeTable}
\caption{Linear solver's data for the fill problem.}
\label{tab:vmpLinRunTime}
\end{table}

With the nonlinear solver active, the same timestep sizes were run.
The pressures from the \dtmax{} = \expneg{1.0}{1}{[s]} case are shown in \fig{fig:nlnFill1em1}.
The measure of error, $e_{p}$, for this simulation was \expneg{3.5}{2}{[psia]}.
This error measure was half that of the linear case at the same \dtmax{}.

\begin{figure}[h!tb]
\centering
\input{plots/vmpNLN1em1}
\caption{Filling problem with \dtmax{} = \expneg{1.0}{1}{[s]} with the nonlinear solver active.}
\label{fig:nlnFill1em1}
\end{figure}

The solution obtained by the nonlinear solver at this large \dtmax{} was comparable to those obtained by the linear solver with the smaller timestep sizes, \dtmax{} = \expneg{5.0}{2}{[s]} and \expneg{1.5}{3}{[s]}.
Examining the actual timestep sizes showed that the nonlinear simulation with \dtmax{} = \expneg{5.0}{2}{[s]} actually ran at \dtmax{} for the majority of timesteps.
This indicates that a more accurate solution can be obtained with fewer timesteps for the same $\dtmax{}$ as a result of resolving the nonlinearities in a problem. 

\begin{figure}[h!tb]
\centering
\input{plots/vmpDeltaTNln1em1}
\caption{Comparison of \dt{} to \dtcrnt{} for the nonlinear solver with \dtmax{} = \expneg{1.0}{1}{[s]}.}
\label{fig:vmpDeltaTNln1em1}
\end{figure}

The nonlinear solver took fewer total timesteps than the linear solver in this simulation.
This was possible because the calculated \dtcrnt{} limit was different for the nonlinear case.
The larger \dtcrnt{} was possible because the nonphysical oscillations in the linear solution's pressures were no longer present.
These deviations had induced large velocities, which had reduced \dtcrnt{} below \dtmax{} causing \cobra{} to reduce the timestep size repeatedly.
The nonlinear solver produced qualitatively and quantitatively similar solutions at more restrictive \dtmax{}.
At the smaller \dtmax{} both the linear and the nonlinear solver's solutions had similar error measures, approximately \expneg{3.5}{2}{[psia]}.

Reducing the nonlinear error at each timestep allowed \cobra{} to run at larger \dt{} without a reduction in the accuracy of the solution.
However, the use of the nonlinear solver imposed additional computational costs.
These costs are evident in \tab{tab:vmpNlnRunTime}.
The run time per timestep of the nonlinear solver for this problem was on average 5.5 times that of the linear solver.
These results indicate that using the nonlinear solver at large timestep sizes can produce solutions that are comparable to those from the linear solver at smaller timesteps.

\begin{table}[h!tb]
\centering
\singlespace
\input{tables/vmpNlnRunTimeTable}
\caption{Nonlinear solver's data for the fill problem.}
\label{tab:vmpNlnRunTime}
\end{table}

The application of the domain decomposition algorithm provided more insight into the impact of unresolved local nonlinearities.
The domain decomposition simulations were run with \dtmax{} = \expneg{1.0}{1}{[s]}.
The first simulation to be examined will be the one with the bottom subchannel in the nonlinear domain, \fig{fig:vmpDDBotChan}.

\begin{figure}[h!tb]
\centering
\input{plots/vmpBotNLN1em1}
\caption{Filling problem with the bottom subchannel in the nonlinear domain.}
\label{fig:vmpDDBotChan}
\end{figure}

While the water front was in the nonlinear domain, the pressures everywhere were in alignment with the analytic solution.
However, once the water front entered the linear domain, the unresolved nonlinearities in the linear domain induced nonphysical pressure oscillations in both domains.
This result was mirrored in the case where the top subchannel was in the nonlinear domain, \fig{fig:vmpDDTopChan}.

\begin{figure}[h!tb]
\centering
\input{plots/vmpTopNLN1em1}
\caption{Filling problem with the top subchannel in the nonlinear domain.}
\label{fig:vmpDDTopChan}
\end{figure}

\fig{fig:vmpDDTopChan} shows that when the water level was in the bottom subchannel, the nonphysical solution propagated globally.
In addition, once the water level entered the nonlinear domain, the solution was out of sync with the analytic solution.
This discrepancy was due to the time lag introduced by the linear solver while the water level was in the linear domain.

This problem highlighted the impact of unresolved nonlinearities on the global solution.
Isolating places where the nonlinearities were present and solving those regions with the nonlinear solver allowed for a global solution that more accurately solved the nonlinear equations.

%============================================================================
% Capstone problem that how the domain decomposition is useful in a quasi-realistic model.
%============================================================================
\FloatBarrier
\section{Refill Problem}
\label{sect:refillProblem}

The final test problem was meant to demonstrate the value of using selective nonlinear refinement to simulate a scenario relevant to LWR safety.
The model was a simplified pressurized water reactor core with upper-head safety injection that was going through the refill phase of an accident scenario.
The intent of this refill problem was to bring together the individual assertions from the previous test problems.
In particular, if there were localized nonlinearities, then the use of the domain decomposition algorithm could produce results that not only were more accurate than those produced by the linear solver, but that were also less computationally expensive.

\subsection{Model}
\label{sect:refillModel}

This problem was a model of a generic nuclear reactor vessel.
\fig{fig:refillModel} contains a schematic of the discrete representation of this problem.
The cross-sectional view on the left of \fig{fig:refillModel} contains the lateral connection information within a given section.
The subchannel view on the right of \fig{fig:refillModel} contains the axial connections between sections.
There were three sections in the problem.
In Section 1 there was the inlet plenum to the core and the two hemispheres of the downcomer.
The downcomers were connected to each other and the inlet plenum, as indicated by the dotted lines.
Section 2 contained six subchannels: two representing the active core, one representing the core-bypass flow paths, one representing the reflector, and two representing the downcomer.
One of the active core subchannels represented the inner ring of the core, denoted by point C.
Another subchannel represented the outer ring of the active core, marked by point D.
And, a third subchannel represented the flow bypass paths, as denoted by the small circle adjoining subchannels C and D in the cross-sectional view.
The reflector subchannel was situated between the active core subchannels and the downcomer subchannels.
The subchannels in Section 2 were hydrodynamically isolated from each other, as indicated by the solid lines.
Section 3 represented the upper head of the reactor.
In this model, there were transverse flow paths connecting all adjacent subchannels in the upper head, as indicated by the dotted lines in the cross-sectional view.
However, the transverse flow paths that connected the reflector subchannels to the two downcomer subchannels were modeled by a specialized set of PDEs meant to represent leakage past the hot-leg nozzle seals, as represented by the red dashed lines in the cross-sectional view.
These equations were specialized physical models for leakage paths and used a homogeneous-flow assumption.
The use of the leakage path models to represent the connections between the reflector subchannels and the downcomer subchannels allowed for a pressure differential to exist between the upper head of the core and the top of the downcomer.
In Section 3 there was also a safety injection inlet at point B, and a pressure connection to containment at point A.

\begin{figure}[h!tb]
\centering
\resizebox{\textwidth}{!}{\input{images/refillComplexModel}}
\caption{\cobra{} model for the refill problem.}
\label{fig:refillModel}
\end{figure}

This simulation started after the blowdown phase of a LOCA.
The lower plenum and the bottom of the downcomer in Section 1 were initially full of saturated water, as indicated by the blue subchannels.
The downcomer in Sections 2 and 3, however, had a mixture of saturated steam and a \ncg{} representing air, as indicated by the grey subchannels.
The mole fraction of the \ncgs{} in these four subchannels started at 25\%.
The pressure boundary condition at point A was connected to an infinite reservoir of this \ncg{}-steam mixture at 45 [psia]. 
Both the four subchannels of the core region in Section 2 and the seven subchannels of the upper head in Section 3 were full of saturated steam, as indicated by the white subchannels.
Of note, this model did not have solid fuel structures to produce heat in the reactor core.
The fuel rods were omitted from this work because the evaluation of the impact of the nonlinear solver on wall heat was beyond the scope of this work.
However, to simulate the presence of these fuel rods, two sources, points C \& D in \fig{fig:refillModel}, produced steam within the two subchannels representing the active core.
These sources were located near the top of Section 2.
The transient behavior of these sources is shown in \fig{fig:refillSteamRates}.
The steam generations rates were chosen such that the steam mass fluxes per core subchannel were equal.

\begin{figure}[h!tb]
\centering
\input{plots/refillSteamRates}
\caption{Refill problem steam generation rates.}
\label{fig:refillSteamRates}
\end{figure}

This steam rose into the upper head and condensation was caused by the safety injection inlet flow.
This safety injection flow was composed of saturated water at 45 [psia] and was initiated at 20 [s] into the transient.
This 20 [s] initialization period allowed the initial conditions to stabilize to prevent the initial stagnant conditions from influencing the transient solution.
Once initiated this safety injection continued throughout the course of the transient.
\fig{fig:refillSafetyInjection} shows this time dependent behavior.

\begin{figure}[h!tb]
\centering
\input{plots/refillSafetyInjection}
\caption{Refill problem safety injection rates.}
\label{fig:refillSafetyInjection}
\end{figure}

\subsection{Results}
\label{sect:refillResults}

Like previous problems, this simulation was subject to timestep sensitivity studies.
The set of timestep sizes analyzed is given by \eqref{eqn:timeStepAlgo}.
For this problem, $\dt{}_{0}$, $r_{f}$, and ${n}$ were 1.28, 2.0, and 11 respectively.
These parameters reduced the $\dtmax{}$ by three orders of magnitude.
Additionally, the nonlinear convergence parameters \kmax{}, $F_{tol}$, and $\delta_{tol}$ were 35, \expneg{1.0}{6}, and \expneg{1.0}{8}, respectively.

The macroscopic transient behavior of the simulation was as follows.
Initially, the safety injection nozzle started to condense the steam present in the core, dropping the pressure in the upper head.
This drop in pressure started to draw a mixture of liquid, air, and steam into the core from the downcomer.
Once the steam generation was initiated, the water seal in the inlet plenum prevented the steam from escaping to containment and the pressure in the upper head increased, causing the liquid water to be pushed out the bottom of the core and back up into the downcomer.
During this period, there were manometer-like oscillations between the downcomer and the core as they filled with water.
The pressurization of the upper head prevented the core from filling in parallel with the downcomer.
The downcomer filled entirely while the upper head was still pressurized with steam.
Concurrent with the filling of the downcomer, the steam flow rate continued to decrease.
Eventually, the safety injection water condensed the remaining steam.
This caused a rapid drain of the downcomer into the core region.
During this rapid draw down, air and steam were drawn back into the core.
This slug of gas traveled through the core, collapsing and rising its way into the upper head.
At that point, the downcomer started to fill again.
\fig{fig:refillCoreVolFracDom} illustrates this macroscopic behavior as calculated by a simulation with \dtmax{} = \expneg{2.0}{2}{[s]}.

\begin{figure}[h!tb]
\centering
\input{plots/refillCoreVolFracDom}
\caption{Effective volume fraction in downcomer and core.}
\label{fig:refillCoreVolFracDom}
\end{figure}

Since this model simulated a core refill event, the parameter of interest was related to core cooling.
The primary variable of engineering interest in this problem was the time-dependent behavior of the condensation in the subchannel containing the safety injection inlet and the net condensation over the course of the transient.

\begin{figure}[h!tb]
\centering
\input{plots/refillGammaLin}
\caption{Condensation in upper head as calculated by the linear solver.}
\label{fig:refillGammaLin}
\end{figure}

\fig{fig:refillGammaLin} shows the upper-head, cumulative condensation from the linear solver for each different $\dtmax{}$.
There was drastic variability in the integrated condensation in the upper head.
However, the two solutions with the smallest $\dtmax{}$ appeared to have reached a timestep-size insensitive solution.
More precisely, there was less variability in integrated condensation between the last two simulations than between any previous two simulations.

\begin{figure}[h!tb]
\centering
\input{plots/refillGammaNln}
\caption{Condensation in upper head as calculated by the nonlinear solver.}
\label{fig:refillGammaNln}
\end{figure}

Next, \fig{fig:refillGammaNln} contains the cumulative condensation in the upper head for each of the different \dtmax{} using the nonlinear solver for the entire solution.
The axes of this graph are the same as those in \fig{fig:refillGammaLin}.
There was a dramatic decrease in both the magnitude and the variability of the quantity as a result of using the nonlinear solver.
These results indicate that the nonlinear solver is capable of producing solutions that are not only more consistent than those produced by the linear solver, but that are also different in value.

\begin{figure}[h!tb]
\centering
\input{plots/refillGammaDom}
\caption{Condensation in upper head as calculated with domain decomposition algorithm.}
\label{fig:refillGammaDom}
\end{figure}

Using selective nonlinear refinement produced the integrated condensations shown in \fig{fig:refillGammaDom}.
The two subchannels in Section 2 that represent the active core region and the four subchannels in Section 3 above the core region comprised the nonlinear domain in this problem.
These results, while not as consistent over the entire range of timesteps analyzed as those produced by the global nonlinear solver, were more consistent and more accurate than those produced by the linear solver.

\begin{figure}[t!hb]
\centering
\input{plots/refillMaxGamma}
\caption{Net condensation in upper head for all three algorithms.}
\label{fig:refillMaxGamma}
\end{figure}

Next, the net condensation for each of the three solution techniques is shown in \fig{fig:refillMaxGamma}.

The linear solver failed to produce results that were comparable with the nonlinear solver even at small timestep sizes.
Using the selective nonlinear refinement algorithm produced solutions that were quantitatively and qualitatively consistent with the nonlinear solution.

\begin{figure}[h!tb]
\centering
\input{plots/refillRunTimeRatios}
\caption{Ratios of nonlinear and dual-domain run times to linear run time.}
\label{fig:refillRunTimeRatios}
\end{figure}

Next, the computational cost of the nonlinear and the domain decomposition solution methods are compared in \fig{fig:refillRunTimeRatios}.
This figure shows the ratio of the full nonlinear and the domain decomposition run times to the linear solver's run time.
While the nonlinear solver is approximately eight times more computationally expensive than the linear solver, the domain decomposition is only three times more computationally expensive than the linear solver.
That is a consistent run time savings of greater than 50\% while using the domain decomposition algorithm as compared to the full nonlinear solver.