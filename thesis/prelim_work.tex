\chapter{Preliminary Work}
\label{chap:prelim_work}
As preliminary work, several steps were taken to evaluate the validity of the proposed research.
To aid in this task a metric was be developed for the evaluation of the nonlinear convergence of a temporally-converged solution.
In order to determine the effects of nonlinear convergence upon the time-step size insensitivity of a solution, the \cobra{} software was modified to enable an iterative Newton method.
Since both objective depend upon the scaling of the nonlinear residuals, a novel operator-based scaling will be utilized to obtain meaningful convergence thresholds.
The scaling of the nonlinear residual is typically done in an arbitrary fashion; a scaling factor that is intrinsically linked to the physics of interest was developed.
This dynamic scaling allows for equal weighting of each of the conservation equation. 
Test problems were developed to show that the metric to test for nonlinear convergence in time-step size insensitive solutions can identify situations where the temporally-converged simulation results may not satisfy the discrete nonlinear equations.
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------
\section{Nonlinear \cobra{}}
\label{sect:nl_cobra}
The first stage of preliminary work was to modify the \cobra{} software.
The \cobra{} software as obtained was a single-shot linearization version of the semi-implicit method.
In order to evaluate the spatially-selective nonlinear refinement, \cobra{} needed to be converted to a fully iterative nonlinear solver.
When it is necessary to distinguish between the single-shot linearization algorithmic implementation of \cobra{} and the iterative nonlinear \cobra{}, the former shall be referred to as legacy mode and the latter as nonlinear mode.
As such, the objectives of this work were to modify the software to be able do the following:

\begin{itemize}
\item{Create a data framework for constructing vector quantities such as $\vec{x}^{k}$ and $\vec{F}$.}
\item{Correctly evaluate $\vec{F}(\vec{x}^{k})$ and $\vec{J}(x^{k})$.}
\item{Implement a globalization strategy for Newton's method.}
\end{itemize}

\cobra{} utilized a single-shot linearization Newton method for its solution technique.
As a result of that design decision, certain memory saving techniques were employed in its construction that precluded the idea of more than one Newton step.
In particular, there was an implicit assumption within the software that the current Newton iterate, $\vec{x}^{n+1, 0}$, was the old-time variable $\vec{x}^{n}$.
This design decision required an an evaluation of all routines involved with the evaluation of components of both the nonlinear residual and the Jacobian.
In addition, the assumption that $\vec{x}^{n+1, k} = \vec{x}^{n}$ required identification of places in the source code where there were implicit cancellation of terms.
Where appropriate, the software was changed to reflect the distinction between old-time and iterate variables and to introduce terms that had been assumed to be equal to zero.

Once the appropriate variables were used for the evaluation of nonlinear residuals and Jacobians, a Newton loop was introduced to allow multiple Newton steps.
\alg{alg:nl_cobra} contains the current algorithmic implementation of the nonlinear semi-implicit method.

\begin{algo}[H]
\caption{Nonlinear \cobra{} solution algorithm.}
\label{alg:nl_cobra}
\setlength{\baselineskip}{0.625\baselineskip}
\begin{algorithmic}[1]
\Require $\vec{x}^{0}$ and $t^{0}$
\Set $n = 0$
\Loop \; Transient Loop
    \State $t^{n+1} : = t^{n} + \Delta t$
    \State $k = 0$
    \State $\vec{x}^{n+1,0} = \vec{x}^{n}$
	\Calculate $\vec{F}(\vec{x}^{n+1,0})$ and $\vec{J}(\vec{x}^{n+1,0})$
    \Loop \; Newton Loop
		\Calculate $\vec{\delta x} = - \vec{J}^{-1}\cdot\vec{F}$
		$j = 0$		
		\Calculate $\vec{x}^{n+1,k+1,j}$
		\Calculate $\vec{F}(\vec{x}^{n+1,k+1,j})$
		\Loop \; Globalization Loop
			\If{ Globalization loop termination criteria not met}
				\Calculate $\lambda_j$
				\Calculate $\vec{x}^{n+1,k+1,j+1} = \vec{x}^{n+1,k} + \lambda \vec{\delta x}$
				\Calculate $\vec{F}(\vec{x}^{n+1,k+1,j+1})$
				\State $j = j + 1$			
			\Else
				\Calculate $\vec{J}(\vec{x}^{n+1,k+1,j})$
				\Exit Globalization Loop
			\EndIf
		\EndLoop			
		\If{ Newton loop termination criteria met}
			\Exit Newton Loop
		\EndIf
	\EndLoop
	\State $n = n + 1$
\EndLoop
\end{algorithmic}
\end{algo}

In \alg{alg:nl_cobra}, there are three steps that require discussion.
First is the Newton Loop termination criteria.
There are three Newton loop termination mechanisms, listed below.

\begin{enumerate}
\item{Maximum number of Newton iterates, $k_{\,\text{MAX}}$, exceeded.}
\item{The L-inf norm of the scaled residual, $||\vec{S}^{-1}\vec{F}||_{\infty}$, is below a specified threshold, $F_{\text{ABS}}$.}
\item{The L-inf norm of the scaled update, $||\vec{D}^{-1}\vec{\delta x}||_{\infty}$, is below a specified threshold, $\delta_{\text{ABS}}$.}
\end{enumerate}

Current values for $k_{\,\text{MAX}}$, $F_{\text{ABS}}$ and $\delta_{\text{ABS}}$ are $35$, $1.0$E$-05$, and $1.0$E$-10$, respectively.
The scaling vectors, $\vec{S}$ and $\vec{D}$, will be addressed later.

The globalization strategy implemented in \cobra{} is a linesearch algorithm \cite{Dennis1996}.
The two globalization loop termination criteria are:

\begin{enumerate}
\item{$\frac{1}{2}||\vec{F}^{k+1, j}||_{2} < \frac{1}{2}||\vec{F}^{k}||_{2} - \alpha ||\vec{F}^{k}||_{2}$ }
\item{$||\lambda_{j+1} \vec{\delta x}||_{\infty} < \delta_{\text{abs}}$}
\end{enumerate}

If neither of the loop termination criteria are met, then the a step-length parameter, $\lambda_j$ is calculated.
On the first pass through the globalization loop within a given Newton step, a quadratic backtracking model is adopted.
On subsequent passes, a cubic-backtracking model is used.
 
Since vector forms of the nonlinear residual and the independent parameters are used in determining nonlinear convergence and in the globalization algorithm, they needed to be easily manipulated.
A subroutine was written to gather the discrete variables of the independent parameters into a single vector.
Additional source code modifications were necessary to construct and gather the components of the nonlinear residual.

\comment{Anything else here? More detail?}

%--------------------------------------------------------------------------------------------------------------------------------------------------------------------
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------
\section{Operator-Based Scaling}
\label{sect:operator_scaling}
In order to determine the degree to which a state vector, $\vec{x}$, satisfies \eqref{eqn:conservation_equations}, the use of the nonlinear residual, $\vec{F}$, is required.
However, the magnitude of the residual for the different conservation equations can vary by orders of magnitude. 
For a given grid location, the nonlinear residuals for mass and energy as formulated in section \ref{subsect:semi_implicit} will have six components.
These residuals will have the units of the conserved quantities for their corresponding PDEs.
Table \ref{tab:scaling_units_scales} shows the range of parameters possible within \cobra{}.

\begin{table}[ht]
\centering
\begin{tabular}{@{}c@{}} \toprule
Scales \\
\bottomrule  
\end{tabular}
\caption{Typical scale for reactor simulations}
\label{tab:scaling_units_scales}
\end{table}

However, during accident scenarios, the range of these values can dramatically change.
One of the challenges that has been addressed during this work is developing a method for scaling that will provide a meaningful metric for convergence.
The scaling chosen should have the following characteristics:
\begin{itemize}
\item{$S^{-1}_k F(x_k)_i \approx 1$ when $x_k$ is a "poor" solution.}
\item{$S^{-1}_k F(x_k)_i \rightarrow 0$ when a phase disappears.}
\item{$0 \leq S^{-1}_k F(x_k)_i \leq 1 $ for all values of $F(x_k)_i$.}
\end{itemize}

The heart of the scaling used in this work is a physics-based method.
To illustrate the scaling procedure, we shall consider \eqref{eqn:conservation_of_liq} for a simply connected continuity cell without inter-field mass transfer.
Assume that the entire channel single-phase and in thermodynamics equilibrium such that the macroscopic densities on either side of this single cell are the same.

\begin{equation}
F = \left(\alpha_k \rho_k\right)^{n+1} - \left( \alpha_k \rho_k \right)^n - \frac{\Delta t}{V} \left( \frac{\alpha_k \rho_k }{<\alpha_k \rho_k>^n} V^{n+1}_{j-1} \right)
\end{equation}

In this equation there are three physically meaningful quantities: the temporal difference, the mass flowing into the cell, and mass flowing out of the volume. 

\comment{I know this needs more work.}

%--------------------------------------------------------------------------------------------------------------------------------------------------------------------
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------
\section{Temporal Convergence}
\label{sect:temporal_convergence}

One of the factors in engineering analysis is the time-step size insensitivity of the solution.
However, a quantifiable measure of time-step size insensitivity is lacking in the literature.
A definition of a temporally converged solution is required.
Ideally, the definition would be the following: as the time-step size is reduced, the solution does not change.
However, this is an unrealistically optimistic definition due to the finite precision of computers.
Another possible definition: as the time-step size is reduced, the change in the solution is small enough.
Unfortunately, this is a subjective definition.
The subjectivity of the definition manifests itself in three parts: ``as the time-step size is reduce," ``change in solution," and ``small enough."

Traditionally, ``change in solution" is addressed in a very qualitative manner.
Engineering judgment of which parameters of the solution are of interest is required.
These parameters may include items such as peak clad temperature or peak system pressure.
The localized nature of examining parameters of interest is a weakness.
This locality means that the entire solution domain is not being considered in the definition ``change in solution."

Another subjective aspect of the definition is the meaning of ``small enough."
Depending upon the context in which the work is being done, this may be nothing more than looking at a graph of the parameter of interest and using engineering judgment to say ``those two graphs look pretty similar."
In some cases, a more quantifiable measure may be used.
Quantifiable metrics may be  ``peak clad temperature does not change by more than $50\,^{\circ}\mathrm{C}$."

The refinement of the temporal discretization is another place where subjectivity comes into play.
``As the time-step size is reduced" is a very amorphous statement.
A more proper statement could be interpreted as ``over the range of time-steps considered."
While it may be that the chosen parameter of interest does not exceed the limits placed upon it with modest time-step refinement, that does not imply that the solution obtained is an accurate solution to the discrete nonlinear problem.

Unfortunately, the subjective meaning of temporal convergence will always be subject to some form of engineering judgment. However, a metric that can quantify the probability that a solution is not accurately temporally converged would be of great value.

The previously mentioned work into nonlinear convergence shows that a solution may be time-step size insensitive but not be the converged solution of the discretized problem \cite{Knoll2001}.
If the nonlinearities of the discrete governing equations are not resolved, then temporal convergence rate can be degraded.
This degradation can produce results that qualitatively appear to be converged due an almost zeroth order of accuracy.
This apparent temporal convergence, or time-step size insensitivity, of the solution is not a result of reaching the solution to the discretized nonlinear equations, but instead is indicative of the degraded order of accuracy due to the failure to resolve the nonlinearities at each time-step.
To determine if the time-step size insensitive transient solution is both time-step size insensitive and an accurate solution to the nonlinear problem, a quantifiable metric is sought.

The norm of the scaled residual from \sect{sect:operator_scaling} provides a well-scaled metric for instantaneous nonlinear convergence at any given time in the simulation.
The residual vector norm is divided by the number of equations in the residual to provide an average residual value per equation.
This equation averaged scaled residual provides a metric for determining the degree of nonlinear convergence.
The natural extension of this metric to transient problems would be a temporal integral, \eqref{eqn:trans_res_simple}, of said norm.

\begin{equation}
\label{eqn:trans_res_simple}
\vec{R} = \int_{t^{0}}^{t^{N}} ||\vec{F}(\tau)||_2 \,\mathrm{d} \tau
\end{equation}

Given the bounds of the scaled residual it was considered desirable to have a similarly scaled transient residual.
The transient residual in \eqref{eqn:trans_res_simple} possesses a dependence upon the number of time-steps taken.
To remove this dependence, a temporal average was instead investigated, \eqref{eqn:trans_res_ave}.

\begin{equation}
\label{eqn:trans_res_ave}
\vec{R} = \frac{\int_{t^{0}}^{t^{N}} ||\vec{F}(\tau)||_2 \,\mathrm{d} \tau}{t^{N} - t^{0}}
\end{equation}

This metric possesses the desirable bounds stated above.
Other weighted temporal integrals were considered, such as a simple moment about $t^{0}$, \eqref{eqn:trans_res_mom}.
However, this moment has the the theoretical disadvantage of weighting the latter portion of the transient.

\begin{equation}
\label{eqn:trans_res_mom}
\vec{R} = \frac{\int_{t^{0}}^{t^{N}} \,\tau\,||\vec{F}(\tau)||_2 \,\mathrm{d} \tau}{\int_{t^{0}}^{t^{N}} \,\tau \,\mathrm{d} \tau}
\end{equation}

For the preliminary work, the \eqref{eqn:trans_res_ave} and \eqref{eqn:trans_res_mom} were selected for evaluation.
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------
%--------------------------------------------------------------------------------------------------------------------------------------------------------------------
\section{Numerical Experiments}
\label{sect:numerical_experiments}

In order to evaluate the interplay between the nonlinear convergence and temporal convergence, two test problems were constructed.
These tests problems were designed to answer the following two questions.

\begin{enumerate}
\item{Does the metric provide a quantifiable measure for the nonlinear convergence of a time-step size insensitive solution?}
\item{Does the single-shot linearization have a converged time-step size insensitive solution similar to that produced by the nonlinear solver for simple problems?}
\end{enumerate}

\subsection{Geometry}
\label{subsect:experimental_geometry}
For both of the test problems, the same computational geometry was used;  \fig{fig:exp_geometry} represents the experimental geometry.
Each block represents a single continuity cell with a height of 4 [in].
The total height of the channel is 48 [in].
Each continuity cell has a cross-sectional area of 4 [in$^2$] and a hydraulic diameter of 4 [in].
The red block at the top of the channel represents a boundary cell where the pressure and enthalpy are specified.
It represents an infinite reservoir filled with a fluid at a specified thermodynamic state.
The red triangle represents a specified flow at the bottom edge of the first continuity cell. 

\begin{figure}[h!t]
\begin{center}
\begin{tikzpicture}
\foreach \x in {1,..., 12} \draw(0, 0.5*\x-0.5) rectangle +(.5,.5);
\filldraw[fill=red] (0, 6) rectangle +(.5,.5); 
\filldraw[fill=red] (0, -0.5) -- (0.25, 0) -- (0.5, -0.5) -- cycle;
\draw[->] (2,0) -- (2, 1) node[anchor=west] {y};
\draw[->] (2,0) -- (3, 0) node[anchor=west] {$\perp y$};
\end{tikzpicture}
\end{center}
\caption{Geometry for test problems.}
\label{fig:exp_geometry}
\end{figure}

\subsection{Initial and Boundary Conditions}
\label{subsect:ic_bc}

The two problems, while having the same geometry, are different in their dominant physics.
One problem was designed to simulate single-phase, single-field continuous liquid flow in a standpipe; this problem will be referred to as the "Single Phase" problem.
The second problem was designed such that high-pressure liquid flashes into steam as it enters a standpipe initially filled with saturated vapor at a much lower pressure, known hereafter as the "Flashing" problem.

Table \ref{tab:ic} provides the initial conditions for the two problems.
The pressure, enthalpy, and volume-fractions for the different fields allow for a complete description of the continuity variables.
The initial velocities are set to zero.

\begin{table}[ht]
\centering
\begin{tabular}{@{}lr@{.}lr@{.}lr@{.}lr@{.}lr@{.}l@{}} \toprule
\multirow{2}{*}{Problem} & \multicolumn{2}{c}{Pressure} & \multicolumn{2}{c}{Enthalpy}             & \multicolumn{2}{c}{$\alpha_g$} & \multicolumn{2}{c}{$\alpha_l$} & \multicolumn{2}{c}{$\alpha_e$} \\ 
                         & \multicolumn{2}{c}{[psia]} & \multicolumn{2}{c}{$[\frac{\text{Btu}}{\text{lb}_{\text{m}}}]$} & \multicolumn{2}{c}{[-]}      & \multicolumn{2}{c}{[-]}      & \multicolumn{2}{c}{[-]}      \\ \midrule
Single Phase             &  200&0                       &  355&5                                   & 0&0                            & 1&0                            & 0&0 \\
Flashing                 &  200&0                       & 1198&3                                   & 1&0                            & 0&0                            & 0&0 \\ \bottomrule  
\end{tabular}
\caption{Initial conditions for test problems.}
\label{tab:ic}
\end{table}

Each of the problems has a specified pressure-enthalpy boundary condition at the top of the stand pipe and a flow-enthalpy boundary condition at the inlet of the domain.
Table \ref{tab:bc_pe} contains the pressure, enthalpy, and composition of the pressure-enthalpy reservoir. 

\begin{table}[ht]
\centering
\begin{tabular}{@{}lr@{.}lr@{.}lr@{.}lr@{.}lr@{.}l@{}} \toprule
\multirow{2}{*}{Problem} & \multicolumn{2}{c}{Pressure} & \multicolumn{2}{c}{Enthalpy}             & \multicolumn{2}{c}{$\alpha_g$} & \multicolumn{2}{c}{$\alpha_l$} & \multicolumn{2}{c}{$\alpha_e$} \\ 
                         & \multicolumn{2}{c}{[psia]} & \multicolumn{2}{c}{$[\frac{\text{Btu}}{\text{lb}_{\text{m}}}]$} & \multicolumn{2}{c}{[-]}      & \multicolumn{2}{c}{[-]}      & \multicolumn{2}{c}{[-]}      \\ \midrule
Single Phase             &  200&0                       &  355&5                                   & 0&0                            & 1&0                            & 0&0 \\
Flashing                 &  200&0                       & 1198&3                                   & 1&0                            & 0&0                            & 0&0 \\ \bottomrule  
\end{tabular}
\caption{Pressure-enthalpy boundary conditions for test problems.}
\label{tab:bc_pe}
\end{table}

The flow-enthalpy boundary condition describes the thermodynamic state of the inflowing fluid and its flow rate.
Table \ref{tab:bc_fe} describes the inlet boundary condition for the two problems.

\begin{table}[ht]
\centering
\begin{tabular}{@{}lr@{.}lr@{.}lr@{.}lr@{.}lr@{.}l@{}} \toprule
\multirow{2}{*}{Problem} & \multicolumn{2}{c}{Pressure} & \multicolumn{2}{c}{Enthalpy}             & \multicolumn{2}{c}{$\alpha_g$} & \multicolumn{2}{c}{$\alpha_l$} & \multicolumn{2}{c}{$\alpha_e$} \\ 
                         & \multicolumn{2}{c}{[psia]} & \multicolumn{2}{c}{$[\frac{\text{Btu}}{\text{lb}_{\text{m}}}]$} & \multicolumn{2}{c}{[-]}      & \multicolumn{2}{c}{[-]}      & \multicolumn{2}{c}{[-]}      \\ \midrule
Single Phase             &  200&0                       &  355&5                                   & 0&0                            & 1&0                            & 0&0 \\
Flashing                 & 1000&0                       &  542&6                                   & 1&0                            & 0&0                            & 0&0 \\ \bottomrule  
\end{tabular}
\caption{Flow-enthalpy boundary conditions for test problems.}
\label{tab:bc_fe}
\end{table}

The specified mass flow, $\dot{m}(t)$, at the bottom of the channels is the same for both problems. 
The is a time-dependent function give by \eqref{eqn:bc_time_func_single}.

\begin{equation}
\label{eqn:bc_time_func_single}
\dot{m}(t) = \left\{
\begin{array}{cclrcll}
 0.0           & [\frac{\text{lb}_{\text{m}}}{\text{s}}] & , &         & t & \leq 1 &[\text{s}] \\
 0.5 ( t - 1)  & [\frac{\text{lb}_{\text{m}}}{\text{s}}] & , & 1 [\text{s}] < & t & \leq 2 &[\text{s}] \\
 0.5           & [\frac{\text{lb}_{\text{m}}}{\text{s}}] & , &         & t & > 2    &[\text{s}]
\end{array}\right.
\end{equation}

Both problems adjust their initial pressure distribution to account for hydrostatic head, which is not specified in the input files.
The \cobra{} input files for both problems can be found in \app{app:input_decks}.

\subsection{Results}
\label{subsect:results}

The two problems were set up so that the maximum allowable time-step was varied.
Each problem was run with the following maximum allowable time-steps: 1 [s], 0.1 [s], 0.01 [s], 0.001 [s], 0.0001 [s], and 0.00001 [s]. 
For the legacy runs, the scaled residuals were evaluated after a single Newton-step.
For the nonlinear runs, the scaled nonlinear residuals were evaluated at the end of the Newton-loop.
The nonlinear convergence criteria used for the nonlinear runs are described in \sect{sect:nl_cobra}.
The temporal convergence metric was evaluated during post-processing.

In total, there were twenty-four simulations run.
The two different problems were each run at six different maximum time-step sizes on each of the two version of \cobra.
Of the twenty-four simulations run, the legacy mode simulation of flashing at a time-step size of 1 [s] failed to run to completion.

\subsubsection{Convergence Criteria}
\label{sect:result_temporal_convergence}

\comment{Does the temporal convergence metric provide a quantifiable measure for a converged time-step size insensitive solution?}

The convergence metric will be used to determine if a qualitative temporal-convergence determination can lead to the acceptance of solution that is not nonlinearly converged.
For each of the test cases, these variables were compared at different time-steps.
First, the 1 [s] max time-step legacy simulation of the flashing problem failed to run.
It could not reduce the time-step size enough to prevent too large of changes to the independent parameters.
However, the nonlinearly convergent \cobra{} was able to run at a 1 [s] time-step.
Both versions of \cobra{} are subject to the same limits on change of independent variables.

\fig{fig:flashing_solution_} shows the gaseous volume fraction 2 [in] from the inlet of the stand pipe as a function of time for a max \dt{} of 1.0E-1 [s] for both the legacy and the nonlinear solvers.
Note that the nonlinearly resolved solution is qualitatively different than the traditional single-shot solution, \fig{fig:flashing_solution}.
As the time-step size is reduced, this discrepancy does does disappear.

The two solutions did not converge as the time-step size was reduced for both.

\begin{figure}
        \centering
        \begin{subfigure}[b]{0.48\textwidth}
                \centering
				I am the nl\_cobra solution.
                \caption{Nonlinear mode.}
                \label{fig:gull}
        \end{subfigure}%
        \begin{subfigure}[b]{0.48\textwidth}
                \centering
				I am the cobra solution.
                \caption{Legacy mode.}
                \label{fig:tiger}
        \end{subfigure}
        \caption{Solutions to the flashing problem.}
        \label{fig:flashing_solution}
\end{figure}

The nonlinear residual for the legacy Flashing problem shows that that even for small time-step sizes, the solution still contains nonlinearities, \fig{fig:legacy_flashing_residual}.
This is in contrast to the nonlinear Flashing problem, which shows a lower nonlinear residual over the course of the simulation, \fig{fig:nonlinear_flashing_residual}.

\begin{figure}[h!t]
\begin{center}
I am a picture.
\end{center}
\caption{Legacy \cobra{} nonlinear residual for Flashing problem.}
\label{fig:legacy_flashing_residual}
\end{figure}

\begin{figure}[h!t]
\begin{center}
I am a picture.
\end{center}
\caption{Nonlinear \cobra{} nonlinear residual for Flashing problem.}
\label{fig:nonlinear_flashing_residual}
\end{figure}

The single-phase case ran just fine for both problems.
Moving on to the case of 0.1 [s].

To examine efficacy of the the temporal convergence criteria, both the average and moment based temporal convergence criteria were evaluated for each of the twenty-three successful simulations.
See \tab{tab:criteria_ave} and \tab{tab:criteria_moment} for the data.

\begin{table}[h!t]
\centering
\begin{tabular}{@{}l r@{.}l r@{.}l r@{.}l r@{.}l @{}}
\toprule
& \multicolumn{4}{c}{Single Phase} & \multicolumn{4}{c}{Flashing}  \\
$\Delta t_{\text{MAX}}$ & \multicolumn{2}{c}{Legacy} & \multicolumn{2}{c}{Nonlinear} & \multicolumn{2}{c}{Legacy}& \multicolumn{2}{c}{Nonlinear}  \\
\midrule
1.0    & 3&149E-3 & 1&700E-3 & \multicolumn{2}{c}{-} & 1&177E-3 \\
1.0E-1 & 2&866E-3 & 1&700E-3 & 5&487E-2 & 1&141E-3 \\
1.0E-2 & 3&412E-4 & 1&357E-3 & 4&960E-2 & 3&413E-4 \\
1.0E-3 & 2&207E-4 & 4&584E-4 & 3&172E-2 & 2&669E-4 \\
1.0E-4 & 1&672E-4 & 1&588E-3 & 2&504E-2 & 1&346E-4 \\
1.0E-5 & 5&493E-4 & 2&758E-4 & 2&166E-2 & 5&075E-5 \\
\bottomrule  
\end{tabular}
\caption{Temporal convergence metric -- average}
\label{tab:criteria_ave}
\end{table}

The average metric for the legacy flashing problem shows that the single-shot case has unresolved nonlinearities of greater magnitude than the nonlinear case.
This is expected.
Other scientist have noted this behavior.


\begin{table}[h!t]
\centering
\begin{tabular}{@{}l r@{.}l r@{.}l r@{.}l r@{.}l @{}}
\toprule
& \multicolumn{4}{c}{Single Phase} & \multicolumn{4}{c}{Flashing}  \\
$\Delta t_{\text{MAX}}$ & \multicolumn{2}{c}{Legacy} & \multicolumn{2}{c}{Nonlinear} & \multicolumn{2}{c}{Legacy}& \multicolumn{2}{c}{Nonlinear}  \\
\midrule
1.0    & 1&485E-3 & 1&070E-4 & \multicolumn{2}{c}{-} & 6&885E-4 \\
1.0E-1 & 1&287E-3 & 1&070E-4 & 5&044E-2 & 6&730E-4 \\
1.0E-2 & 1&417E-4 & 7&701E-5 & 4&570E-2 & 2&511E-4 \\
1.0E-3 & 8&805E-5 & 1&178E-4 & 2&372E-2 & 1&975E-4 \\
1.0E-4 & 1&834E-5 & 4&958E-5 & 1&838E-2 & 8&974E-5 \\
1.0E-5 & 1&916E-5 & 8&939E-5 & 1&922E-2 & 4&581E-5 \\
\bottomrule  
\end{tabular}
\caption{Temporal convergence metric -- moment}
\label{tab:criteria_moment}
\end{table}

\subsubsection{Lack of Nonlinearities}
\label{sect:result_linear_problem}

\comment{Does the single-shot linearization have temporal convergence properties similar to the nonlinear solver in the absence of nonlinearities?}

The single-phase problem should be relatively linear.
As such, the solution produced by the linear solver should be the same as that produced by the linear solver.
In addition, the solution should be time-step size insensitive from the beginning.


It should also show that the solution for both the single-shot and the nonlinear versions of \cobra{} produced the same result.
The nonlinear \cobra{} did not produce the same results.
This is where I show the blowup picture of the oscillatory solution.
I also show how the residual increases as the time-step size is decreased.
It produced solutions with bounded oscillations at smaller time-step sizes.
In addition the residuals appear to be growing with smaller time-steps.
I do not know why at the moment.
This poor behavior could be the result of multiple issues.
One possibility is the inconsistency between the scaled update vector used in the line-search algorithm and  the one used in the Newton loop convergence criteria.
Another possibility is the limiters used in the operator-based scaling were chosen poorly.

\section{Review}
\label{sect:review}

In review, the single-shot semi-implicit \cobra{} software was converted to a nonlinearly convergent, semi-implicit algorithm.
An operator-based scaling was introduced and implemented into the nonlinear \cobra{}.
Deficiencies were identified with the current implementation of the operator-based scaling.
A metric to quantify the nonlinear convergence of a temporally converged simulation was developed and implemented.
Tests indicated that a time-step size insensitive solution may not be nonlinearly converged and can be an incorrect solution to the nonlinear discrete equations.